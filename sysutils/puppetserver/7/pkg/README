Puppetserver on OpenBSD
-----------------------

Usually on other operating systems, Puppetserver is bundled
together with the Puppet agent, including an independent Ruby interpreter.
Due to incompatibilities between the JRuby bundled with Puppetserver,
and a few Ruby gems relying on the system Ruby, the
dependencies usually bundled with Puppetserver have to be installed
manually into Puppetserver:

# puppetserver gem install --no-document puppet hiera-eyaml \
	hiera-file ipaddress msgpack

You may not need hiera-eyaml, hiera-file, or ipaddress gem, on the
other hand, your Puppet modules might rely on other gems.

Puppet and Puppetserver rely on the facter gem. OpenBSD support was
added only recently, not yet merged upstream. The facter gem installed
as package alongside Puppet agent comes with OpenBSD support.

As long as that support is not yet released upstream, you have to copy
over the gem from its system location into Puppetserver:
rm -rf ${LOCALSTATEDIR}/puppetlabs/puppetserver/data/jruby-gems/gems/facter-*
cp -r ${LOCALBASE}/lib/ruby/gems/3.1/gems/facter-* \
	${LOCALSTATEDIR}/puppetlabs/puppetserver/data/jruby-gems/gems/

If you're using PuppetDB, you have to copy over the PuppetDB termini
into Puppetservers Puppet lib directory:

cp -r ${LOCALBASE}/share/puppetlabs/puppet/puppet/ \
	${LOCALSTATEDIR}/puppetlabs/puppetserver/data/jruby-gems/gems/puppet-7*/lib/
